import{j as e}from"./ui-vendor-DuzoyoLP.js";import{r as f,u as V}from"./react-vendor-BLXwT7zj.js";import{c as A}from"./customer.service.fixed-BwwfzteX.js";import{s as W,c as N,y as w}from"./index-DEcLH6Mq.js";import{a as $}from"./utils-vendor-BiZXfEo0.js";const F={async getAll(){return console.log("[CustomersAPI] Getting all customers"),A.getCustomers()},async getById(t){console.log("[CustomersAPI] Getting customer by ID:",t);const a=await A.getCustomer(t);if(!a)throw new Error("Customer not found");return a},async create(t){return console.log("[CustomersAPI] Creating customer:",t),A.createCustomer({name:t.name,phone:t.phone||void 0,email:t.email||void 0,address:t.address,notes:t.notes||void 0})},async update(t,a){return console.log("[CustomersAPI] Updating customer:",t,a),A.updateCustomer(t,{name:a.name,phone:a.phone,email:a.email,address:a.address,notes:a.notes})},async delete(t){console.log("[CustomersAPI] Deleting customer:",t),await A.deleteCustomer(t)},async sync(){console.log("[CustomersAPI] Syncing...");const t=await W.syncAll();console.log("[CustomersAPI] Sync result:",t)},async refresh(){console.log("[CustomersAPI] Refreshing from server..."),await A.refreshFromServer()}},X="https://khs-crm-backend.onrender.com",z=$.create({baseURL:`${X}/api`,headers:{"Content-Type":"application/json"}});z.interceptors.request.use(t=>{const a=localStorage.getItem("khs-crm-token");return a&&(t.headers.Authorization=`Bearer ${a}`),t});const L={async getAll(t){try{return(await z.get("/jobs",{params:t})).data}catch(a){const c=localStorage.getItem("khs-crm-jobs");if(c){let o=JSON.parse(c);return t&&(t.status&&(o=o.filter(i=>i.status===t.status)),t.customerId&&(o=o.filter(i=>i.customerId===t.customerId)),t.priority&&(o=o.filter(i=>i.priority===t.priority))),o}throw a}},async getById(t){return(await z.get(`/jobs/${t}`)).data},async create(t){try{return(await z.post("/jobs",t)).data}catch(a){if(!navigator.onLine){const c={...t,id:`temp_${Date.now()}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},o=localStorage.getItem("khs-crm-jobs"),i=o?JSON.parse(o):[];i.push(c),localStorage.setItem("khs-crm-jobs",JSON.stringify(i));const u=localStorage.getItem("khs-crm-sync-queue")||"[]",m=JSON.parse(u);return m.push({type:"job",action:"create",data:c,timestamp:Date.now()}),localStorage.setItem("khs-crm-sync-queue",JSON.stringify(m)),c}throw a}},async update(t,a){try{return(await z.put(`/jobs/${t}`,a)).data}catch(c){if(!navigator.onLine){const o=localStorage.getItem("khs-crm-jobs");if(o){const i=JSON.parse(o),u=i.findIndex(m=>m.id===t);if(u!==-1){i[u]={...i[u],...a,updatedAt:new Date().toISOString()},localStorage.setItem("khs-crm-jobs",JSON.stringify(i));const m=localStorage.getItem("khs-crm-sync-queue")||"[]",x=JSON.parse(m);return x.push({type:"job",action:"update",id:t,data:a,timestamp:Date.now()}),localStorage.setItem("khs-crm-sync-queue",JSON.stringify(x)),i[u]}}}throw c}},async delete(t){try{await z.delete(`/jobs/${t}`)}catch(a){if(navigator.onLine)throw a;{const c=localStorage.getItem("khs-crm-jobs");if(c){const i=JSON.parse(c).filter(x=>x.id!==t);localStorage.setItem("khs-crm-jobs",JSON.stringify(i));const u=localStorage.getItem("khs-crm-sync-queue")||"[]",m=JSON.parse(u);m.push({type:"job",action:"delete",id:t,timestamp:Date.now()}),localStorage.setItem("khs-crm-sync-queue",JSON.stringify(m))}}}},async getByCustomerId(t){return this.getAll({customerId:t})},async sync(){const t=localStorage.getItem("khs-crm-sync-queue");if(!t)return;const a=JSON.parse(t);if(a.filter(o=>o.type==="job").length!==0)try{const o=localStorage.getItem("khs-crm-jobs"),i=o?JSON.parse(o):[],m=(await z.post("/jobs/sync",{jobs:i})).data.results;for(const y of m)if(y.status==="created"&&y.data){const j=y.id,I=y.data.id,S=i.findIndex(l=>l.id===j);S!==-1&&(i[S]=y.data)}localStorage.setItem("khs-crm-jobs",JSON.stringify(i));const x=a.filter(y=>y.type!=="job");localStorage.setItem("khs-crm-sync-queue",JSON.stringify(x))}catch(o){throw o}}},ee="https://khs-crm-backend.onrender.com",te=$.create({baseURL:`${ee}/api`,headers:{"Content-Type":"application/json"}}),P={async autoLogin(){try{const t=await te.post("/auth/login",{email:"admin@khscrm.com",password:"admin123"}),{token:a,refreshToken:c,user:o}=t.data;return localStorage.setItem("khs-crm-token",a),localStorage.setItem("khs-crm-refresh-token",c),localStorage.setItem("khs-crm-user",JSON.stringify(o)),{token:a,user:o}}catch{const a="dev-token-"+Date.now(),c={id:"dev-user",email:"dev@khscrm.com",name:"Development User",role:"OWNER"};return localStorage.setItem("khs-crm-token",a),localStorage.setItem("khs-crm-user",JSON.stringify(c)),{token:a,user:c}}},getCurrentUser(){const t=localStorage.getItem("khs-crm-user");return t?JSON.parse(t):null},getToken(){return localStorage.getItem("khs-crm-token")},logout(){localStorage.removeItem("khs-crm-token"),localStorage.removeItem("khs-crm-refresh-token"),localStorage.removeItem("khs-crm-user")}};function oe(){const[t,a]=f.useState({apiUrl:"https://khs-crm-backend.onrender.com",online:navigator.onLine,token:localStorage.getItem("khs-crm-token")?"Present":"Missing",syncQueue:W.getPendingOperations(),lastError:null});f.useEffect(()=>{(async()=>{try{console.log("[SyncDiagnostics] Testing backend connection...");const u=await N.get("/api/health");console.log("[SyncDiagnostics] Backend health check:",u),a(m=>({...m,lastError:null}))}catch(u){console.error("[SyncDiagnostics] Backend connection failed:",u),a(m=>({...m,lastError:u}))}})()},[]);const c=async()=>{try{console.log("[SyncDiagnostics] Fetching customers...");const i=await N.get("/api/customers");console.log("[SyncDiagnostics] Customers fetched:",i),alert(`Fetched ${i.length} customers from backend`)}catch(i){console.error("[SyncDiagnostics] Customer fetch failed:",i),alert(`Failed to fetch customers: ${i}`)}},o=async()=>{try{console.log("[SyncDiagnostics] Creating test customer...");const i=await N.post("/api/customers",{name:`Test Customer ${Date.now()}`,address:"123 Test St",phone:"555-0123"});console.log("[SyncDiagnostics] Customer created:",i),alert(`Created customer: ${i.name} (ID: ${i.id})`)}catch(i){console.error("[SyncDiagnostics] Customer create failed:",i),alert(`Failed to create customer: ${i}`)}};return e.jsxs("div",{className:"fixed bottom-4 right-4 bg-white shadow-lg rounded-lg p-4 max-w-sm z-50",children:[e.jsx("h3",{className:"font-bold text-sm mb-2",children:"Sync Diagnostics"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:["API URL: ",t.apiUrl]}),e.jsxs("div",{children:["Online: ",t.online?"âœ…":"âŒ"]}),e.jsxs("div",{children:["Auth Token: ",t.token]}),e.jsxs("div",{children:["Queue Size: ",t.syncQueue.length]}),t.lastError&&e.jsxs("div",{className:"text-red-600",children:["Error: ",t.lastError.message]})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("button",{onClick:c,className:"w-full text-xs bg-blue-500 text-white px-2 py-1 rounded",children:"Test Fetch Customers"}),e.jsx("button",{onClick:o,className:"w-full text-xs bg-green-500 text-white px-2 py-1 rounded",children:"Test Create Customer"})]})]})}const pe=()=>{const t=V(),[a,c]=f.useState([]),[o,i]=f.useState(!0),[u,m]=f.useState(null),x=async()=>{try{i(!0);const r=await F.getAll();c(r),m(null)}catch{m("Failed to load customers")}finally{i(!1)}};f.useEffect(()=>{(async()=>{P.getToken()||await P.autoLogin(),await x()})()},[]),f.useEffect(()=>{const r=()=>{const k=customerStorage.getAll();k&&c(k)},n=async()=>{console.log("[CustomersPage] Running auto-sync..."),customerStorage.save(a),localStorage.setItem("khs-crm-last-sync",new Date().toISOString());try{await F.sync(),console.log("[CustomersPage] Sync completed"),await x()}catch(k){console.error("[CustomersPage] Sync failed:",k)}window.dispatchEvent(new Event("storage")),r()},d=k=>{(k.key==="khs-crm-customers"||k.key==="khs-crm-jobs"||k.key==="khs-crm-last-sync")&&r()},g=setInterval(n,9e5),B=()=>{console.log("[CustomersPage] Device came online, syncing..."),n()};return window.addEventListener("online",B),window.addEventListener("storage",d),r(),()=>{clearInterval(g),window.removeEventListener("storage",d),window.removeEventListener("online",B)}},[]);const[y,j]=f.useState(!1),[I,S]=f.useState(null),[l,p]=f.useState(""),[s,h]=f.useState("name"),[b,C]=f.useState(!1),[D,v]=f.useState(null),[E,T]=f.useState(null),O=[...a].sort((r,n)=>{switch(s){case"name":return r.name.localeCompare(n.name);case"reference":const d={HOD:1,Yelp:2,Cust:3},g=d[r.reference]||4,B=d[n.reference]||4;return g-B;case"recent":return n.id.localeCompare(r.id);default:return 0}}).filter(r=>r.name.toLowerCase().includes(l.toLowerCase())||r.email.toLowerCase().includes(l.toLowerCase())||r.phone.includes(l)||r.address.toLowerCase().includes(l.toLowerCase())||r.notes&&r.notes.toLowerCase().includes(l.toLowerCase())),[J,R]=f.useState({});f.useEffect(()=>{const r=async()=>{try{const n=await L.getAll(),d={};n.forEach(g=>{d[g.customerId]||(d[g.customerId]=[]),d[g.customerId].push(g)}),R(d)}catch{}};a.length>0&&r()},[a]);const M=r=>J[r]||[],q=async r=>{try{const n=await F.create(r);c([n,...a]),w.success("Customer added successfully"),j(!1)}catch{w.error("Failed to add customer")}},U=async r=>{try{const n=await F.update(I.id,r);c(a.map(d=>d.id===n.id?n:d)),w.success("Customer updated successfully"),S(null),j(!1)}catch{w.error("Failed to update customer")}},H=async r=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await F.delete(r),c(a.filter(n=>n.id!==r)),w.success("Customer deleted successfully")}catch{w.error("Failed to delete customer")}},Q=(r,n)=>{n.stopPropagation(),window.location.href=`tel:${r.replace(/\D/g,"")}`},Y=(r,n)=>{n.stopPropagation();const d=encodeURIComponent(r);window.open(`https://www.google.com/maps/search/?api=1&query=${d}`,"_blank")},_=(r,n)=>{n.stopPropagation(),window.location.href=`mailto:${r}`},Z=r=>{v(r),C(!0)},G=async r=>{try{if(r.id){const n=await L.update(r.id,r);R(d=>{const g=[...d[n.customerId]||[]],B=g.findIndex(k=>k.id===n.id);return B!==-1?(g[B]=n,{...d,[n.customerId]:g}):d}),w.success("Job updated successfully")}else{const n=await L.create({...r,customerId:D.id,status:r.status||"QUOTED",priority:r.priority||"medium",totalCost:r.totalCost||0,depositPaid:r.depositPaid||0});R(d=>({...d,[D.id]:[...d[D.id]||[],n]})),w.success("Job created successfully")}}catch{w.error("Failed to save job")}C(!1),v(null),T(null)},K=async r=>{try{await L.delete(r),R(n=>{const d={...n};return Object.keys(d).forEach(g=>{d[g]=d[g].filter(B=>B.id!==r)}),d}),w.success("Job deleted successfully")}catch{w.error("Failed to delete job")}};return e.jsxs("div",{style:{height:"100%",overflowY:"auto",WebkitOverflowScrolling:"touch",paddingBottom:"100px"},children:[e.jsx("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx("button",{onClick:()=>t("/dashboard"),style:{background:"none",border:"none",padding:"8px",cursor:"pointer",display:"flex",alignItems:"center",color:"#6B7280",borderRadius:"6px",marginTop:"-4px"},onMouseEnter:r=>r.currentTarget.style.backgroundColor="#F3F4F6",onMouseLeave:r=>r.currentTarget.style.backgroundColor="transparent",children:e.jsx("svg",{style:{width:"28px",height:"28px"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:"bold",margin:0},children:"Customers"})]}),e.jsx("button",{onClick:()=>{S(null),j(!0)},style:{padding:"8px 16px",backgroundColor:"#3B82F6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"+ Add Customer"})]})}),e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx("input",{type:"text",placeholder:"Search customers...",value:l,onChange:r=>p(r.target.value),style:{width:"100%",padding:"12px",border:"1px solid #D1D5DB",borderRadius:"8px",fontSize:"16px"}})}),e.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>h("name"),style:{padding:"6px 12px",backgroundColor:s==="name"?"#3B82F6":"#E5E7EB",color:s==="name"?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"Name"}),e.jsx("button",{onClick:()=>h("reference"),style:{padding:"6px 12px",backgroundColor:s==="reference"?"#3B82F6":"#E5E7EB",color:s==="reference"?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"Reference"}),e.jsx("button",{onClick:()=>h("recent"),style:{padding:"6px 12px",backgroundColor:s==="recent"?"#3B82F6":"#E5E7EB",color:s==="recent"?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"Recent"})]}),o?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"40px",color:"#6B7280"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Loading customers..."})]})}):O.length===0?e.jsx("div",{style:{backgroundColor:"white",padding:"40px",borderRadius:"8px",textAlign:"center",color:"#6B7280"},children:l?"No customers found matching your search.":"No customers yet. Add your first customer to get started."}):e.jsx("div",{style:{display:"grid",gap:"16px"},children:O.map(r=>e.jsx("div",{onClick:()=>t(`/customers/${r.id}`),style:{backgroundColor:"white",padding:"16px",borderRadius:"8px",cursor:"pointer",transition:"box-shadow 0.2s",border:"1px solid #E5E7EB"},onMouseEnter:n=>{n.currentTarget.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)"},onMouseLeave:n=>{n.currentTarget.style.boxShadow="none"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:r.name}),r.reference&&e.jsx("span",{style:{padding:"2px 8px",backgroundColor:r.reference==="HOD"?"#10B981":r.reference==="Yelp"?"#F59E0B":"#3B82F6",color:"white",borderRadius:"12px",fontSize:"10px",fontWeight:"500"},children:r.reference})]}),e.jsx("button",{onClick:n=>_(r.email,n),style:{background:"none",border:"none",color:"#666",textDecoration:"none",cursor:"pointer",padding:"4px 0",font:"inherit",fontSize:"12px",display:"block",marginBottom:"8px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",textAlign:"left"},onMouseEnter:n=>{n.currentTarget.style.color="#3B82F6",n.currentTarget.style.textDecoration="underline"},onMouseLeave:n=>{n.currentTarget.style.color="#666",n.currentTarget.style.textDecoration="none"},children:r.email}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},children:[e.jsx("button",{onClick:n=>Q(r.phone,n),title:"Call customer",style:{background:"none",border:"1px solid #3B82F6",color:"#3B82F6",borderRadius:"4px",cursor:"pointer",padding:"4px 8px",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},children:"ðŸ“ž Call"}),e.jsx("button",{onClick:n=>{n.stopPropagation(),window.location.href=`sms:${r.phone.replace(/\D/g,"")}`},title:"Text customer",style:{background:"none",border:"1px solid #3B82F6",color:"#3B82F6",borderRadius:"4px",cursor:"pointer",padding:"4px 8px",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},children:"ðŸ’¬ Text"}),e.jsx("span",{style:{fontSize:"12px",color:"#666"},children:r.phone})]}),e.jsx("button",{onClick:n=>Y(r.address,n),style:{background:"none",border:"none",color:"#6B7280",textDecoration:"none",cursor:"pointer",padding:"4px 0",font:"inherit",fontSize:"11px",display:"block",lineHeight:"1.3",textAlign:"left",marginBottom:"8px"},onMouseEnter:n=>{n.currentTarget.style.color="#3B82F6",n.currentTarget.style.textDecoration="underline"},onMouseLeave:n=>{n.currentTarget.style.color="#6B7280",n.currentTarget.style.textDecoration="none"},children:r.address}),r.notes&&e.jsx("p",{style:{fontSize:"11px",color:"#9CA3AF",fontStyle:"italic",margin:"0",lineHeight:"1.3",paddingTop:"4px"},children:r.notes}),(()=>{const n=M(r.id);return n.length>0?e.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px solid #E5E7EB"},children:[e.jsxs("p",{style:{fontSize:"12px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:["Jobs (",n.length,"):"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:n.map(d=>e.jsxs("button",{onClick:g=>{g.stopPropagation(),v(r),T(d),C(!0)},style:{background:"none",border:"1px solid #D1D5DB",borderRadius:"4px",padding:"6px 8px",textAlign:"left",cursor:"pointer",fontSize:"11px",color:"#374151",transition:"all 0.2s"},onMouseEnter:g=>{g.currentTarget.style.backgroundColor="#F3F4F6",g.currentTarget.style.borderColor="#3B82F6"},onMouseLeave:g=>{g.currentTarget.style.backgroundColor="transparent",g.currentTarget.style.borderColor="#D1D5DB"},children:[e.jsx("div",{style:{fontWeight:"500"},children:d.title}),d.startDate&&e.jsx("div",{style:{color:"#6B7280",fontSize:"10px"},children:new Date(d.startDate).toLocaleDateString()})]},d.id))})]}):null})()]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),S(r),j(!0)},style:{padding:"4px 12px",fontSize:"12px",backgroundColor:"#E5E7EB",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Edit"}),e.jsx("button",{onClick:n=>{n.stopPropagation(),H(r.id)},style:{padding:"4px 12px",fontSize:"12px",backgroundColor:"#FEE2E2",color:"#DC2626",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Delete"}),e.jsxs("button",{onClick:n=>{n.stopPropagation(),Z(r)},style:{padding:"4px 12px",fontSize:"12px",backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{fontSize:"14px"},children:"+"})," Add Job"]})]})]})},r.id))}),y&&e.jsx(re,{customer:I,onClose:()=>{j(!1),S(null)},onSave:I?U:q}),b&&D&&e.jsx(ne,{customer:D,existingJob:E,onClose:()=>{C(!1),v(null),T(null)},onSave:G,onDelete:K}),e.jsx(oe,{})]})},re=({customer:t,onClose:a,onSave:c})=>{const[o,i]=f.useState({reference:(t==null?void 0:t.reference)||"",name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",street:"",city:"",state:"",zip:"",notes:(t==null?void 0:t.notes)||""});f.useEffect(()=>{if(t!=null&&t.address){const l=t.address.split(", ");if(l.length>=3){const[p,s,h]=l,b=h.split(" ");i(C=>({...C,street:p,city:s,state:b[0]||"",zip:b[1]||""}))}}},[t]);const u={"123 main st":{city:"Springfield",state:"IL",zip:"62701"},"456 oak ave":{city:"Springfield",state:"IL",zip:"62702"},"789 elm street":{city:"Springfield",state:"IL",zip:"62703"},"321 maple drive":{city:"Springfield",state:"IL",zip:"62704"},"654 pine road":{city:"Chicago",state:"IL",zip:"60601"},"987 cedar lane":{city:"Chicago",state:"IL",zip:"60602"},"111 walnut way":{city:"Bloomington",state:"IL",zip:"61701"},"222 birch boulevard":{city:"Champaign",state:"IL",zip:"61820"},"350 ward ave":{city:"Honolulu",state:"HI",zip:"96814"},"1717 ala wai blvd":{city:"Honolulu",state:"HI",zip:"96815"}},m={62701:{city:"Springfield",state:"IL"},62702:{city:"Springfield",state:"IL"},62703:{city:"Springfield",state:"IL"},62704:{city:"Springfield",state:"IL"},60601:{city:"Chicago",state:"IL"},60602:{city:"Chicago",state:"IL"},61701:{city:"Bloomington",state:"IL"},61820:{city:"Champaign",state:"IL"},96814:{city:"Honolulu",state:"HI"},96815:{city:"Honolulu",state:"HI"},10001:{city:"New York",state:"NY"},90210:{city:"Beverly Hills",state:"CA"},94105:{city:"San Francisco",state:"CA"},98101:{city:"Seattle",state:"WA"},33139:{city:"Miami Beach",state:"FL"},"02134":{city:"Boston",state:"MA"},78701:{city:"Austin",state:"TX"},85001:{city:"Phoenix",state:"AZ"},80202:{city:"Denver",state:"CO"},30303:{city:"Atlanta",state:"GA"}},x=l=>{const p=l.replace(/\D/g,"");return p.length===0?"":p.length<=3?`(${p}`:p.length<=6?`(${p.slice(0,3)}) ${p.slice(3)}`:`(${p.slice(0,3)}) ${p.slice(3,6)}-${p.slice(6,10)}`},y=l=>{const p=x(l.target.value);p.length<=14&&i({...o,phone:p})},j=l=>{const p=l.target.value;i({...o,street:p});const s=p.toLowerCase().trim(),h=u[s];h&&i(b=>({...b,street:p,city:h.city,state:h.state,zip:h.zip}))},I=l=>{const p=l.target.value;if(i({...o,zip:p}),p.length===5){const s=m[p];s&&i(h=>({...h,zip:p,city:s.city,state:s.state}))}},S=l=>{l.preventDefault();const p=`${o.street}, ${o.city}, ${o.state} ${o.zip}`;c({id:t==null?void 0:t.id,reference:o.reference,name:o.name,email:o.email,phone:o.phone,address:p,notes:o.notes})};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"8px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsx("div",{style:{padding:"20px",borderBottom:"1px solid #E5E7EB"},children:e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:"600"},children:t?"Edit Customer":"Add New Customer"})}),e.jsxs("form",{onSubmit:S,style:{padding:"20px"},children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Reference"}),e.jsxs("select",{value:o.reference,onChange:l=>i({...o,reference:l.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Select reference..."}),e.jsx("option",{value:"HOD",children:"HOD"}),e.jsx("option",{value:"Yelp",children:"Yelp"}),e.jsx("option",{value:"Cust",children:"Customer Referral"})]})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Name *"}),e.jsx("input",{type:"text",value:o.name,onChange:l=>i({...o,name:l.target.value}),required:!0,style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Email *"}),e.jsx("input",{type:"email",value:o.email,onChange:l=>i({...o,email:l.target.value}),required:!0,style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Phone *"}),e.jsx("input",{type:"tel",value:o.phone,onChange:y,required:!0,placeholder:"(555) 123-4567",style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Street Address *"}),e.jsx("input",{type:"text",value:o.street,onChange:j,required:!0,placeholder:"123 Main St",style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",gap:"12px",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"City *"}),e.jsx("input",{type:"text",value:o.city,onChange:l=>i({...o,city:l.target.value}),required:!0,style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"State *"}),e.jsx("input",{type:"text",value:o.state,onChange:l=>i({...o,state:l.target.value}),required:!0,maxLength:2,style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px",textTransform:"uppercase"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"ZIP *"}),e.jsx("input",{type:"text",value:o.zip,onChange:I,required:!0,maxLength:5,style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px"}})]})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Notes"}),e.jsx("textarea",{value:o.notes,onChange:l=>i({...o,notes:l.target.value}),rows:3,style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px",resize:"vertical"}})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{type:"submit",style:{flex:1,padding:"10px",backgroundColor:"#3B82F6",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:"pointer"},children:t?"Update Customer":"Add Customer"}),e.jsx("button",{type:"button",onClick:a,style:{flex:1,padding:"10px",backgroundColor:"#E5E7EB",color:"#374151",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:"pointer"},children:"Cancel"})]})]})]})})},ne=({customer:t,onClose:a,onSave:c,existingJob:o=null,onDelete:i=null})=>{const[u,m]=f.useState("description"),[x,y]=f.useState({title:(o==null?void 0:o.title)||"",description:(o==null?void 0:o.description)||"",photos:(o==null?void 0:o.photos)||[],plans:(o==null?void 0:o.plans)||[],notes:(o==null?void 0:o.notes)||"",comments:(o==null?void 0:o.comments)||[]}),j=[{id:"description",label:"Job Description",icon:"ðŸ“‹"},{id:"photos",label:"Photos",icon:"ðŸ“¸"},{id:"plans",label:"Drawings/Plans",icon:"ðŸ“"},{id:"notes",label:"Notes",icon:"ðŸ“"},{id:"comments",label:"Comments",icon:"ðŸ’¬"}],I=s=>{Array.from(s.target.files||[]).forEach(b=>{const C=new FileReader;C.onload=D=>{y(v=>{var E;return{...v,photos:[...v.photos,{id:Date.now()+Math.random(),url:(E=D.target)==null?void 0:E.result,name:b.name}]}})},C.readAsDataURL(b)})},S=s=>{Array.from(s.target.files||[]).forEach(b=>{const C=new FileReader;C.onload=D=>{y(v=>{var E;return{...v,plans:[...v.plans,{id:Date.now()+Math.random(),url:(E=D.target)==null?void 0:E.result,name:b.name,type:b.type}]}})},C.readAsDataURL(b)})},l=s=>{s.trim()&&y(h=>({...h,comments:[...h.comments,{id:Date.now(),text:s,timestamp:new Date().toISOString(),author:"Current User"}]}))},p=s=>{s.preventDefault(),c(o?{...o,...x}:x)};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"8px",maxWidth:"900px",width:"90%",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{padding:"20px",borderBottom:"1px solid #E5E7EB"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,fontSize:"20px",fontWeight:"600"},children:[o?"Edit Job":"Add Job"," for ",t.name]}),e.jsx("p",{style:{margin:"4px 0 0 0",color:"#6B7280",fontSize:"14px"},children:t.address})]}),o&&i&&e.jsx("div",{style:{display:"flex",gap:"8px"},children:e.jsx("button",{type:"button",onClick:()=>{window.confirm("Are you sure you want to delete this job?")&&(i(o.id),a())},style:{padding:"8px 16px",backgroundColor:"#FEE2E2",color:"#DC2626",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Delete Job"})})]})}),e.jsx("div",{style:{display:"flex",borderBottom:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",overflowX:"auto"},children:j.map(s=>e.jsxs("button",{onClick:()=>m(s.id),style:{padding:"12px 20px",border:"none",backgroundColor:u===s.id?"white":"transparent",borderBottom:u===s.id?"2px solid #3B82F6":"2px solid transparent",cursor:"pointer",fontSize:"14px",fontWeight:u===s.id?"600":"400",color:u===s.id?"#3B82F6":"#6B7280",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{children:s.icon}),s.label]},s.id))}),e.jsxs("form",{onSubmit:p,style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[u==="description"&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Job Title *"}),e.jsxs("select",{value:x.title,onChange:s=>y({...x,title:s.target.value}),required:!0,style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Select job type..."}),e.jsx("option",{value:"Kitchen",children:"Kitchen"}),e.jsx("option",{value:"Bathroom",children:"Bathroom"}),e.jsx("option",{value:"Flooring",children:"Flooring"}),e.jsx("option",{value:"Various Repairs",children:"Various Repairs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"4px",fontWeight:"500"},children:"Description"}),e.jsx("textarea",{value:x.description,onChange:s=>y({...x,description:s.target.value}),rows:6,placeholder:"Describe the work to be done...",style:{width:"100%",padding:"12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px",resize:"vertical"}})]})]}),u==="photos"&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:I,style:{display:"none"},id:"photo-upload"}),e.jsx("label",{htmlFor:"photo-upload",style:{display:"inline-block",padding:"10px 20px",backgroundColor:"#3B82F6",color:"white",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"+ Upload Photos"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"12px"},children:x.photos.map(s=>e.jsxs("div",{style:{position:"relative",paddingBottom:"100%",backgroundColor:"#F3F4F6",borderRadius:"8px",overflow:"hidden"},children:[e.jsx("img",{src:s.url,alt:s.name,onDoubleClick:()=>window.open(s.url,"_blank"),style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",cursor:"pointer"},title:"Double-click to open"}),e.jsx("button",{type:"button",onClick:()=>{y(h=>({...h,photos:h.photos.filter(b=>b.id!==s.id)}))},style:{position:"absolute",top:"4px",right:"4px",backgroundColor:"rgba(0,0,0,0.7)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"12px"},children:"âœ•"})]},s.id))})]}),u==="plans"&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",multiple:!0,onChange:S,style:{display:"none"},id:"plan-upload"}),e.jsx("label",{htmlFor:"plan-upload",style:{display:"inline-block",padding:"10px 20px",backgroundColor:"#3B82F6",color:"white",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"+ Upload Documents"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:x.plans.map(s=>e.jsxs("div",{onDoubleClick:()=>window.open(s.url,"_blank"),style:{display:"flex",alignItems:"center",padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"6px",border:"1px solid #E5E7EB",cursor:"pointer"},title:"Double-click to open",children:[e.jsx("span",{style:{fontSize:"24px",marginRight:"12px"},children:s.type.includes("pdf")?"ðŸ“„":"ðŸ–¼ï¸"}),e.jsx("span",{style:{flex:1,fontSize:"14px"},children:s.name}),e.jsx("button",{type:"button",onClick:h=>{h.stopPropagation(),y(b=>({...b,plans:b.plans.filter(C=>C.id!==s.id)}))},style:{backgroundColor:"transparent",color:"#DC2626",border:"none",cursor:"pointer",fontSize:"14px"},children:"Remove"})]},s.id))})]}),u==="notes"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Job Notes"}),e.jsx("textarea",{value:x.notes,onChange:s=>y({...x,notes:s.target.value}),rows:10,placeholder:"Add any notes about this job...",style:{width:"100%",padding:"12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"16px",resize:"vertical"}})]}),u==="comments"&&e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"20px"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",id:"new-comment",placeholder:"Add a comment...",style:{flex:1,padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:"6px",fontSize:"14px"},onKeyPress:s=>{if(s.key==="Enter"){s.preventDefault();const h=s.target;l(h.value),h.value=""}}}),e.jsx("button",{type:"button",onClick:()=>{const s=document.getElementById("new-comment");l(s.value),s.value=""},style:{padding:"8px 16px",backgroundColor:"#3B82F6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"Add"})]})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:x.comments.map(s=>e.jsxs("div",{style:{padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"6px",border:"1px solid #E5E7EB"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"500",fontSize:"14px"},children:s.author}),e.jsx("span",{style:{color:"#6B7280",fontSize:"12px"},children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{style:{margin:0,fontSize:"14px"},children:s.text})]},s.id))})]})]}),e.jsxs("div",{style:{padding:"20px",borderTop:"1px solid #E5E7EB",display:"flex",gap:"12px"},children:[e.jsx("button",{type:"submit",disabled:!x.title,style:{flex:1,padding:"10px",backgroundColor:x.title?"#3B82F6":"#9CA3AF",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:x.title?"pointer":"not-allowed"},children:o?"Update Job":"Create Job"}),e.jsx("button",{type:"button",onClick:a,style:{flex:1,padding:"10px",backgroundColor:"#E5E7EB",color:"#374151",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:"pointer"},children:"Cancel"})]})]})]})})};export{pe as default};
//# sourceMappingURL=CustomersEnhanced-09OTVS2s.js.map
